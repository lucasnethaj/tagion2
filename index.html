<!-- index.html -->

<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/npm/docsify@4/themes/vue.css"
    />
  </head>
  <body>
    <div id="app"></div>
    <script src='documents/_static/viz.js'></script>
    <script src='documents/_static/full.render.js'></script>;
    <script>

      // const workerURL = 'documents/_static/full.render.js'
      // let viz = new Viz({ workerURL });
      let viz = new Viz();

      // FÃ¸j for satan
      function vizScript(code) {
        return `<script type="text/javascript" async>` +
        `(function() {` +
        `let script = document.currentScript; ` +
        `viz.renderSVGElement('${code}').then(svg => { ` +
              `console.log(svg)` +
        // `         script.parentNode.replaceChild(svg, script); ` +
        // `}); ` +
		`})();` +
        `<\/script>`
      }

      window.$docsify = {

        // load from _sidebar.md
        loadSidebar: true,

        search: 'auto', // default

            search: [
              '/',            // => /README.md
            ],

          markdown: {
              renderer: {
                  code : function(code, lang) {
                      if ( lang === "graphviz") {
                        return (
                              `<div class='graphviz'>` +
                            vizScript(code) +
                               `</div>`
                        )
                      }
                      return this.origin.code.apply(this, arguments);
                  }
              }
          },

          // plugins: [
          //     function vizjs(hook, vm) {

          //         var LANG = 'graphviz';
          //         var SELECTOR = 'pre[data-lang="' + LANG + '"]'

          //       function replace(content) {
          //           var dom = window.Docsify.dom
          //           var $ = dom.create('span', content)

          //           if (!$.querySelectorAll) {
          //             return content
          //           }

          //           (dom.findAll($, SELECTOR) || []).forEach(function (element) {
          //                 // viz.renderSVGElement(element.innerText)

          //             // element.parentNode.replaceChild(planted, element)
          //             // return $.innerHTML
          //               var parent = element.parentNode
          //                 var planted = dom.create('p', '<h1>This was a graphviz another graph</h1>')
          //               if (parent) {
          //                   planted.dataset.lang = LANG
          //                   element.parentNode.replaceChild(planted, element)
          //               }
          //         })
          //       }

          //       hook.afterEach(function (content) {
          //             return replace(content)
          //       })
          //   },
        // ]
      };

    </script>
    <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
    <script src="documents/_static/docsify-viz.js"></script>
  </body>
</html>
